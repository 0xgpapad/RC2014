#include <stdio.h>
#include <stdint.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

#include "dgvideo.h"

static const uint8_t dg_font[] = {
/* 00 */
	0x00,0x00,0x00,0x00,0x31,0x4A,0x44,0x4A,0x31,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 01 */
	0x3C,0x22,0x3C,0x22,0x22,0x3C,0x20,0x20,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 02 */
	0x00,0x61,0x12,0x14,0x18,0x10,0x30,0x30,0x30,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 03 */
	0x30,0x48,0x40,0x40,0x20,0x30,0x48,0x48,0x30,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 04 */
	0x00,0x00,0x18,0x20,0x40,0x78,0x40,0x20,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 05 */
	0x16,0x0E,0x10,0x20,0x40,0x40,0x38,0x04,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 06 */
	0x00,0x2C,0x52,0x12,0x12,0x12,0x02,0x02,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 07 */
	0x18,0x24,0x42,0x42,0x7E,0x42,0x42,0x24,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 08 */
	0x00,0x00,0x00,0x40,0x40,0x40,0x40,0x48,0x30,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 09 */
	0x00,0x00,0x40,0x48,0x50,0x60,0x50,0x4A,0x44,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 0A */
	0x40,0x20,0x10,0x10,0x10,0x10,0x18,0x24,0x42,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 0B */
	0x00,0x48,0x48,0x48,0x48,0x74,0x40,0x40,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 0C */
	0x00,0x00,0x00,0x62,0x22,0x24,0x28,0x30,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 0D */
	0x08,0x1C,0x20,0x18,0x20,0x40,0x3C,0x02,0x0C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 0E */
	0x00,0x00,0x00,0x18,0x24,0x42,0x42,0x24,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 0F */
	0x00,0x00,0x00,0x3F,0x54,0x14,0x14,0x14,0x14,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 10 */
	0x18,0x24,0x42,0x42,0x64,0x58,0x40,0x40,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 11 */
	0x00,0x00,0x00,0x1F,0x24,0x42,0x42,0x24,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 12 */
	0x00,0x00,0x00,0x3F,0x48,0x08,0x08,0x08,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 13 */
	0x00,0x00,0x00,0x62,0x24,0x24,0x24,0x24,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 14 */
	0x10,0x10,0x38,0x54,0x54,0x54,0x38,0x10,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 15 */
	0x00,0x00,0x00,0x00,0x62,0x14,0x08,0x14,0x23,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 16 */
	0x08,0x49,0x2A,0x2A,0x2A,0x1C,0x08,0x08,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 17 */
	0x00,0x00,0x00,0x22,0x41,0x49,0x49,0x49,0x36,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 18 */
	0x00,0x1C,0x22,0x41,0x41,0x41,0x22,0x22,0x63,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 19 */
	0x1F,0x10,0x10,0x10,0x10,0x10,0x50,0x30,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 1A */
	0x00,0x00,0x04,0x02,0x7F,0x02,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 1B */
	0x00,0x00,0x10,0x20,0x7F,0x20,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 1C */
	0x08,0x1C,0x2A,0x08,0x08,0x08,0x08,0x08,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 1D */
	0x00,0x00,0x08,0x00,0x7F,0x00,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 1E */
	0x7F,0x20,0x10,0x08,0x06,0x08,0x10,0x20,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 1F */
	0x00,0x30,0x49,0x06,0x30,0x49,0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 20 */
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 21 */
	0x08,0x08,0x08,0x08,0x08,0x08,0x00,0x00,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 22 */
	0x12,0x12,0x12,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 23 */
	0x14,0x14,0x14,0x7F,0x14,0x7F,0x14,0x14,0x14,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 24 */
	0x08,0x3F,0x48,0x48,0x3E,0x09,0x09,0x7E,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 25 */
	0x20,0x51,0x22,0x04,0x08,0x10,0x22,0x45,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 26 */
	0x38,0x44,0x44,0x28,0x10,0x29,0x46,0x46,0x39,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 27 */
	0x20,0x20,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 28 */
	0x08,0x10,0x20,0x20,0x20,0x20,0x20,0x10,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 29 */
	0x08,0x04,0x02,0x02,0x02,0x02,0x02,0x04,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 2A */
	0x08,0x49,0x2A,0x1C,0x7F,0x1C,0x2A,0x49,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 2B */
	0x00,0x08,0x08,0x08,0x7F,0x08,0x08,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 2C */
	0x00,0x00,0x00,0x00,0x00,0x30,0x10,0x10,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 2D */
	0x00,0x00,0x00,0x00,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 2E */
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 2F */
	0x00,0x01,0x02,0x04,0x08,0x10,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 30 */
	0x3E,0x41,0x43,0x45,0x49,0x51,0x61,0x41,0x3E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 31 */
	0x08,0x18,0x08,0x08,0x08,0x08,0x08,0x08,0x3E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 32 */
	0x3E,0x41,0x01,0x02,0x0C,0x10,0x20,0x40,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 33 */
	0x3E,0x41,0x01,0x01,0x1E,0x01,0x01,0x41,0x3E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 34 */
	0x02,0x06,0x0A,0x12,0x22,0x7F,0x02,0x02,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 35 */
	0x7F,0x40,0x40,0x40,0x7E,0x01,0x01,0x41,0x3E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 36 */
	0x3E,0x41,0x40,0x40,0x7E,0x41,0x41,0x41,0x3E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 37 */
	0x7F,0x41,0x02,0x04,0x08,0x10,0x10,0x10,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 38 */
	0x3E,0x41,0x41,0x41,0x3E,0x41,0x41,0x41,0x3E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 39 */
	0x3F,0x41,0x41,0x41,0x3F,0x01,0x01,0x41,0x3E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 3A */
	0x00,0x00,0x20,0x00,0x00,0x00,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 3B */
	0x20,0x00,0x00,0x00,0x00,0x30,0x10,0x10,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 3C */
	0x04,0x08,0x10,0x20,0x40,0x20,0x10,0x08,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 3D */
	0x00,0x00,0x00,0x7F,0x00,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 3E */
	0x10,0x08,0x04,0x02,0x01,0x02,0x04,0x08,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 3F */
	0x3E,0x41,0x41,0x02,0x04,0x08,0x08,0x00,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 40 */
	0x3E,0x41,0x41,0x4D,0x55,0x5E,0x40,0x40,0x3E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 41 */
	0x1C,0x22,0x41,0x41,0x7F,0x41,0x41,0x41,0x41,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 42 */
	0x7E,0x21,0x21,0x21,0x3E,0x21,0x21,0x21,0x7E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 43 */
	0x1E,0x21,0x40,0x40,0x40,0x40,0x40,0x21,0x1E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 44 */
	0x7E,0x21,0x21,0x21,0x21,0x21,0x21,0x21,0x7E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 45 */
	0x7F,0x40,0x40,0x40,0x78,0x40,0x40,0x40,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 46 */
	0x7F,0x40,0x40,0x40,0x78,0x40,0x40,0x40,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 47 */
	0x1E,0x21,0x40,0x40,0x40,0x47,0x41,0x21,0x1E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 48 */
	0x41,0x41,0x41,0x41,0x7F,0x41,0x41,0x41,0x41,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 49 */
	0x3E,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x3E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 4A */
	0x1F,0x04,0x04,0x04,0x04,0x04,0x04,0x44,0x38,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 4B */
	0x41,0x42,0x44,0x48,0x70,0x48,0x44,0x42,0x41,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 4C */
	0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 4D */
	0x41,0x63,0x55,0x49,0x49,0x41,0x41,0x41,0x41,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 4E */
	0x41,0x61,0x51,0x49,0x45,0x43,0x41,0x41,0x41,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 4F */
	0x1C,0x22,0x41,0x41,0x41,0x41,0x41,0x22,0x1C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 50 */
	0x7E,0x41,0x41,0x41,0x7E,0x40,0x40,0x40,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 51 */
	0x1C,0x22,0x41,0x41,0x41,0x41,0x45,0x22,0x1D,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 52 */
	0x7E,0x41,0x41,0x41,0x7E,0x48,0x44,0x42,0x41,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 53 */
	0x3E,0x41,0x40,0x40,0x3E,0x01,0x01,0x41,0x3E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 54 */
	0x7F,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 55 */
	0x41,0x41,0x41,0x41,0x41,0x41,0x41,0x41,0x3E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 56 */
	0x41,0x41,0x41,0x41,0x41,0x41,0x22,0x14,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 57 */
	0x41,0x41,0x41,0x49,0x49,0x49,0x55,0x63,0x41,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 58 */
	0x41,0x41,0x22,0x14,0x08,0x14,0x22,0x41,0x41,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 59 */
	0x41,0x41,0x22,0x14,0x08,0x08,0x08,0x08,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 5A */
	0x7F,0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 5B */
	0x1E,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x1E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 5C */
	0x00,0x40,0x20,0x10,0x08,0x04,0x02,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 5D */
	0x3C,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x3C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 5E */
	0x3E,0x41,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 5F */
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 60 */
	0x02,0x02,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 61 */
	0x00,0x00,0x00,0x1E,0x22,0x42,0x42,0x46,0x3A,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 62 */
	0x40,0x40,0x40,0x5C,0x62,0x42,0x42,0x62,0x5C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 63 */
	0x00,0x00,0x00,0x3C,0x42,0x40,0x40,0x42,0x3C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 64 */
	0x02,0x02,0x02,0x3A,0x46,0x42,0x42,0x46,0x3A,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 65 */
	0x00,0x00,0x00,0x3C,0x42,0x42,0x7E,0x40,0x3E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 66 */
	0x0C,0x12,0x10,0x10,0x7C,0x10,0x10,0x10,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 67 */
	0x3A,0x46,0x42,0x42,0x46,0x3A,0x02,0x02,0x3C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 68 */
	0x40,0x40,0x40,0x58,0x64,0x42,0x42,0x42,0x42,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 69 */
	0x00,0x08,0x00,0x18,0x08,0x08,0x08,0x08,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 6A */
	0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x42,0x3C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 6B */
	0x40,0x40,0x40,0x44,0x48,0x70,0x48,0x44,0x42,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 6C */
	0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 6D */
	0x00,0x00,0x00,0x76,0x49,0x49,0x49,0x49,0x49,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 6E */
	0x00,0x00,0x00,0x5C,0x62,0x42,0x42,0x42,0x42,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 6F */
	0x00,0x00,0x00,0x3C,0x42,0x42,0x42,0x42,0x3C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 70 */
	0x5C,0x62,0x42,0x42,0x62,0x5C,0x40,0x40,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 71 */
	0x3A,0x46,0x42,0x42,0x46,0x3A,0x02,0x02,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 72 */
	0x00,0x00,0x00,0x5C,0x62,0x40,0x40,0x40,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 73 */
	0x00,0x00,0x00,0x3C,0x42,0x30,0x0C,0x42,0x3C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 74 */
	0x00,0x10,0x10,0x7C,0x10,0x10,0x10,0x12,0x0C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 75 */
	0x00,0x00,0x00,0x42,0x42,0x42,0x42,0x42,0x3C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 76 */
	0x00,0x00,0x00,0x44,0x44,0x44,0x44,0x28,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 77 */
	0x00,0x00,0x00,0x41,0x49,0x49,0x49,0x49,0x36,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 78 */
	0x00,0x00,0x00,0x42,0x24,0x18,0x18,0x24,0x42,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 79 */
	0x42,0x42,0x42,0x42,0x46,0x3A,0x02,0x42,0x3C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 7A */
	0x00,0x00,0x00,0x7E,0x04,0x08,0x10,0x20,0x7E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 7B */
	0x0E,0x10,0x10,0x10,0x20,0x10,0x10,0x10,0x0E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 7C */
	0x08,0x08,0x08,0x00,0x00,0x08,0x08,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 7D */
	0x38,0x04,0x04,0x04,0x02,0x04,0x04,0x04,0x38,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 7E */
	0x30,0x49,0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/* 7F */
	0x7F,0x7F,0x7F,0x7F,0x7F,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

struct dgvideo {
    uint8_t ptr;
    uint8_t mem[128];	/* 6bit wide */
    uint8_t last;
    uint32_t raster[128 * 256];
};

/* 8 pixels per char X = 256 pixels a scan line,  4096 pixels a character
   row  */

static void dg_raster(struct dgvideo *dg, unsigned int byte)
{
    uint8_t c = dg->mem[byte] & 0x7F;
    const uint8_t *fontptr = dg_font + 16 * c;
    uint32_t *rptr = dg->raster + ((byte & 0xE0) << 7) + ((byte & 0x1F) << 3);
    unsigned int x,y;
    uint8_t bits;

    for (y = 0; y < 16; y++) {
        bits = *fontptr++;
        for (x = 0; x < 8; x++) {
            if (bits & 0x80)
                *rptr++ = 0xFFAAAAAA;
            else
                *rptr++ = 0xFF222222;
            bits <<= 1;
        }
        rptr += 248;	/* We moved on 8 in the loop */
    }
}

/* Write only device */
void dgvideo_write(struct dgvideo *dg, uint8_t val)
{
    if (val == 0xFF)
        dg->ptr = 0;
    /* Bit 6 goes low to high */
    if ((dg->last ^ val) & val & 0x80) {
        dg->ptr++;
    }
    dg->last = val;    
    dg->mem[dg->ptr] = val & 0x7F; 
    dg_raster(dg, dg->ptr);
}

struct dgvideo *dgvideo_create(void)
{
    struct dgvideo *dg = malloc(sizeof(struct dgvideo));
    unsigned int i;

    if (dg == NULL) {
        fprintf(stderr, "Out of memory.\n");
        exit(1);
    }
    dg->ptr = 0;
    memset(dg->raster, 0x99, sizeof(dg->raster));
    for (i = 0; i <= 255; i++) {
        dg_raster(dg, i);
    }
    return dg;
}

void dgvideo_free(struct dgvideo *dg)
{
    free(dg);
}

uint32_t *dgvideo_get_raster(struct dgvideo *dg)
{
    return dg->raster;
}
